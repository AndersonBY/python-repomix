# 🧙‍♂️ Release Wizard - 傻瓜式发布向导

完全交互式的发布向导，一步步引导您完成发布，无需记住任何命令！

## 🚀 快速开始

只需运行一个命令：

```bash
# 推荐方式：使用 PDM 脚本
pdm run release

# 或者直接运行脚本
python scripts/release-wizard.py
```

就这样！向导会引导您完成整个发布流程。

## ✨ 向导流程

### 🔍 第1步: 环境检查
- ✅ 检查是否在 Git 仓库中
- ✅ 检查工作目录是否干净
- ✅ 检查是否在主分支
- ✅ 检查必要文件是否存在

### 📝 第2步: 收集提交信息
向导会询问：
- 是否使用最新的 Git 标签作为起点？
- 收集多少个提交？(全部/10个/20个/自定义)
- 自动运行 `collect-commits.py` 脚本

### 🤖 第3步: 生成 CHANGELOG
向导会：
- 告诉您运行哪个 Claude Code 命令
- 提供详细的提示词
- 等待您完成后继续

**示例 Claude Code 命令:**
```bash
claude "请查看 commits-for-changelog.md 并将这些提交转换为专业的 CHANGELOG.md 条目，然后将生成的内容写入到 CHANGELOG.md 文件中"
```

### ✏️ 第4步: 编辑 CHANGELOG
向导会：
- 检查 CHANGELOG.md 是否存在
- 提示您使用编辑器修改
- **智能预览**: 显示 `[Unreleased]` 部分内容（即将发布的内容）
- 等待您确认完成

**预览示例:**
```
CHANGELOG.md 预览 - [Unreleased] 部分:
这是即将发布的内容:
--------------------------------------------------
## [Unreleased]

### Added
- 🐳 Docker support for easy deployment
- 🚀 Interactive release wizard

### Fixed  
- 🐛 Line numbering issues resolved
--------------------------------------------------
```

### 🏷️ 第5步: 确定版本号
向导会询问：
- **补丁版本** (0.3.0 → 0.3.1) - 错误修复
- **次要版本** (0.3.0 → 0.4.0) - 新功能，向后兼容
- **主要版本** (0.3.0 → 1.0.0) - 破坏性更改
- 或手动输入版本号

**智能版本预览:**
```
ℹ️  当前版本: 0.3.0
ℹ️  根据这次的更改，选择版本升级类型:

❓ 选择版本类型:
👉 1. 补丁版本 (Patch) - 主要是错误修复 (0.3.0 → 0.3.1)
   2. 次要版本 (Minor) - 新功能，向后兼容 (0.3.0 → 0.4.0)
   3. 主要版本 (Major) - 破坏性更改 (0.3.0 → 1.0.0)
   4. 手动指定版本号
```

### 🧪 第6步: 运行测试
向导会（可选）：
- 运行 pytest 测试
- 运行 Ruff 代码检查
- 运行 Pyright 类型检查
- **详细错误显示**: 失败时显示具体错误信息
- 允许您跳过或忽略失败

**错误显示示例:**
```
ℹ️  正在运行 Ruff 检查...
❌ 运行 Ruff 检查失败:
──────────────────────────────────────────────────
src/repomix/cli.py:25:1: F401 'os' imported but unused
src/repomix/core.py:102:5: E302 expected 2 blank lines, found 1
src/repomix/utils.py:45:80: E501 line too long (85 > 79 characters)
... (省略了 8 行错误信息)
完整错误信息请查看上述命令的输出
──────────────────────────────────────────────────
❓ 忽略运行 Ruff 检查失败并继续? (y/N):
```

### 💾 第7步: 提交 CHANGELOG
向导会：
- 检查 CHANGELOG.md 是否有更改
- 自动添加到 Git 暂存区
- 询问提交消息（提供默认值）
- 执行提交

### 🚀 第8步: 创建发布
向导会：
- **发布内容预览**: 再次显示 `[Unreleased]` 部分的内容
- 显示发布摘要确认
- 运行 `release.py` 脚本
- 创建 Git 标签并推送
- 触发 GitHub Actions 自动发布

**最终确认示例:**
```
📋 即将发布的内容预览:
----------------------------------------
### Added
- 🐳 Docker support for easy deployment
- 🚀 Interactive release wizard
### Fixed  
- 🐛 Line numbering issues resolved
... (还有 3 行)
----------------------------------------

发布摘要:
• 版本规格: patch
• CHANGELOG.md 已更新
• 测试已通过 (或已跳过)
• 准备推送到 GitHub 并触发自动发布

❓ 确认创建发布? (Y/n):
```

## 🎨 用户体验特色

### 🌈 美观的界面
- 彩色输出和表情符号
- 清晰的步骤进度显示
- 直观的成功/警告/错误提示

### 🤝 智能交互
- 所有问题都有默认答案
- 支持中英文输入
- 详细的提示和说明

### 🛡️ 安全检查
- 每一步都有确认
- 可以随时取消
- 自动检查前置条件

### 📋 进度跟踪
```
📍 步骤 3/8: 生成 CHANGELOG 内容
ℹ️  现在需要使用 Claude Code 来生成 CHANGELOG 内容
✅ 提交信息收集完成!
```

## 💡 使用示例

### 典型的对话流程：

```
🚀 Repomix 发布向导
================================================

ℹ️  这个向导将引导您完成整个发布流程
❓ 是否开始发布流程? (Y/n): 

📍 步骤 1/8: 检查环境
✅ 环境检查通过!

📍 步骤 2/8: 收集提交信息
ℹ️  发现最新标签: v0.3.0
❓ 从标签 v0.3.0 开始收集提交? (Y/n): y

❓ 选择收集方式:
👉 1. 收集自 v0.3.0 以来的所有提交
   2. 收集最近的 10 次提交
   3. 收集最近的 20 次提交
   4. 自定义提交数量
请选择 (1-4, 默认 1): 

ℹ️  正在收集提交信息...
✅ 提交信息收集完成!

📍 步骤 3/8: 生成 CHANGELOG 内容
请在新的终端窗口中运行以下命令:
claude "请将这些提交转换为专业的 CHANGELOG.md 条目..."

⏸️  运行完 Claude Code 命令后按 Enter 继续...
```

## 🔧 自定义选项

向导支持：
- 跳过测试检查
- 自定义提交消息
- 手动指定版本号
- 灵活的提交收集范围

## 🆘 故障排除

如果遇到问题：
1. **Ctrl+C** 随时中断向导
2. 向导会显示详细的错误信息
3. 每一步都可以重新开始
4. 查看 GitHub Actions 页面获取发布状态

## 🎯 总结

现在发布就像聊天一样简单：
1. 运行 `pdm run release`（或 `python scripts/release-wizard.py`）
2. 跟着向导的问题回答
3. 在提示时运行 Claude Code 命令
4. 坐等发布完成！

**完全傻瓜式，零记忆负担！** 🧠✨